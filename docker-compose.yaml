version: '3.8'

services:
  postgresdb:
    extends:
      file: ../pweb-b/docker-compose.yaml
      service: postgresdb
    env_file:
      - ./envs/.env.database

  redis:
    extends:
      file: ../pweb-b/docker-compose.yaml
      service: redis

  bweb:
    extends:
      file: ../pweb-b/docker-compose.yaml
      service: backend
    env_file:
      - ./envs/.env.backend
    depends_on:
      - postgresdb
      - redis
    links:
      - redis
      - postgresdb

  fweb:
    extends:
      file: ../pweb-f/docker-compose.yaml
      service: frontend
    env_file:
      - ./envs/.env.frontend
    depends_on:
      - bweb

  ocserv:
    build: ./ocserv
    restart: always
    ports:
      - "4443:443/tcp"
      - "4443:443/udp"
    # volumes:
    #   - "/opt/ocserv:/etc/ocserv"
    environment:
      - VPN_DOMAIN=vpn.easypi.pro
      - VPN_NETWORK=10.20.30.0
      - VPN_NETMASK=255.255.255.0
      - LAN_NETWORK=192.168.0.0
      - LAN_NETMASK=255.255.0.0
      - VPN_USERNAME=testm
      - VPN_PASSWORD=strongpasswrodMohsn
    cap_add:
      - NET_ADMIN

  nginx:
    build: ./nginx
    ports:
      - "80:80"
    depends_on:
      - fweb
      - ocserv
